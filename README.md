# Cookiecutter Static Site Deployment

Rapidly deploy a static website to the [Amazon Web Services (AWS)](https://aws.amazon.com/) cloud.

The project generated by this template uses a [CloudFormation](https://aws.amazon.com/cloudformation/) script to quickly create:

- 2 S3 Buckets:
    - a Root Bucket for storing the website
    - a Log Bucket for storing logs from the Root Bucket and CloudFront
- 1 CloudFront Distribution (AWS' Content-Distribution Network [CDN])
  with TLS
- 1 Hosted Zone (a DNS zone)
    - 2 DNS A Records for both domain.tld and www.domain.tld


## Requirements

The tools required to generate a project using this template:

- [Python](https://www.python.org/) 2.7 or 3.3+
- [pip](https://pip.pypa.io/)
- [virtualenvwrapper](https://pypi.python.org/pypi/virtualenvwrapper) (recommended but technically optional)
- [Cookiecutter](https://github.com/audreyr/cookiecutter)

Tools required to obtain a security certificate:

- [OpenSSL](https://www.openssl.org/)

The tools required to use the project generated by this template.

- [JQ](https://stedolan.github.io/jq/)

All other requirements (including [AWS
CLI](https://pypi.python.org/pypi/awscli)) are in the template's
[`requirements.txt`](https://github.com/jambonsw/cookiecutter-static-site/blob/master/%7B%7B%20cookiecutter.project_slug%20%7D%7D/requirements.txt)
file.


## Generating a Project with this Template

1. Sign up for [AWS](http://aws.amazon.com/)
2. Generate the project using
   [Cookiecutter](https://github.com/audreyr/cookiecutter),
   [virtualenvwrapper](https://pypi.python.org/pypi/virtualenvwrapper), and
   this template

    ```console
    $ mkvirtualenv PROJECT_SLUG  # replace PROJECT_SLUG
    $ pip install cookiecutter
    $ cd $PROJECT_HOME  # PROJECT_HOME is used by virtualenvwrapper, and must be defined in .bashrc
    $ cookiecutter gh:jambonsw/cookiecutter-static-site
    $ cd PROJECT_SLUG  # replace with the value you specified when prompted by cookiecutter
    $ setvirtualenvproject  # or: setvirtualenvproject $VIRTUAL_ENV $(builtin pwd)
    $ pip install -r requirements.txt
    $ mv env.sh $WORKON_HOME/$(basename $VIRTUAL_ENV)/bin/postactivate
    $ mv unenv.sh $WORKON_HOME/$(basename $VIRTUAL_ENV)/bin/postdeactivate
    ```
    
    Example prompt input:
    ```console
    project_name [My Static Website]: JamBon Software
    project_slug [jambon-software]: jambonsw
    domain_name [example.com]: jambonsw.com
    aws_access_key_id [XXXXXXXXXXXXXXXXXXXX]:
    aws_secret_access_key [XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX]: 
    ```

3. Obtain a TLS Certificate

    ```console
    $ cd certificates
    $ openssl genrsa 2048 > private-key.pem
    $ openssl req -new -key private-key.pem -out csr.pem
    $ # Buy Cert; upload CSR
    $ # for any files received:
    $ openssl x509 -in jambonsw_com.crt -outform pem -out jambonsw_com_cert.pem
    $ # 3 files expected: certificate, certificate chain, private key
    $ # for example, this might be: jambonsw_com_cert.pem jambonsw_com_ca_chain.pem private-key.pem
    ```

## Deploy Static Website

1. Activate Envionment

    ```console
    $ workon PROJECT_SLUG  # replace PROJECT_SLUG
    ```

2. Upload the TLS Certificate to AWS

    ```console
    $ make upload-cert
    ```

3. Add the certificate ID to the CloudFormation script.

    1. Get the certificate ID:

        ```console
        $ make get-cert
        ```

    2. Copy and paste the ID into 
       `aws_scripts/cloudformation_parameters.json`,
       between the quotation marks at the end of line 7.


3. Create CloudFormation Stack

    ```console
    $ make create-stack
    ```

4. Go Make Tea. The stack will take a bit. (Only the AWS web console
   will be able to tell you when the stack is done.)

5. Point your domain at the nameservers. Use code below to get your
   nameservers.

    ```console
    $ make dns
    ```

6. Upload your content

    ```console
    $ make
    ```

Your site is now in the cloud!

## Update your Site

If you add content to the `content` directory, simply use `make` to
update your site.

If you change the cloudformation scripts (you can!) you may use `make
stack` to update the stack.

## Deleting the Stack

```console
$ make delete-stack
```

Voila!
